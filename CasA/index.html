<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>CasA App</title>
    <link href="CasA.css" rel="stylesheet">
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-curve-component/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script type="text/javascript" src="index.js"></script>
  </head>
  <body>
  <a-scene id="mainScene" background="color: #aaf">
      <a-assets>
        <a-asset-item id="fekcorr" src="data/fekcorr-filt-nomtl.gltf">
        </a-asset-item>
        <a-asset-item id="cco" src="data/cco-filt.gltf">
        </a-asset-item>
        <a-asset-item id="ar" src="data/newar-filt.gltf">
        </a-asset-item>
        <a-asset-item id="hetg" src="data/newhetg.gltf">
        </a-asset-item>
        <a-asset-item id="jets" src="data/newjets.gltf">
        </a-asset-item>
        <a-asset-item id="opt" src="data/newopt.gltf">
        </a-asset-item>
        <a-asset-item id="si" src="data/newsi-filt.gltf">
        </a-asset-item>
      </a-assets>

      <a-curve id="prepreOrbit">
        <a-curve-point position="0 10 60"></a-curve-point>
        <a-curve-point position="0 10.1 60"></a-curve-point>
      </a-curve>
      
      <a-curve id="preOrbit">
        <a-curve-point position="0 10.1 60"></a-curve-point>
        <a-curve-point position="0 11 60"></a-curve-point>
      </a-curve>
      
      <a-curve id="firstOrbit">
        <a-curve-point position="0 11 60"></a-curve-point>
        <a-curve-point position="25 25 60"></a-curve-point>
        <a-curve-point position="25 -25 60"></a-curve-point>
        <a-curve-point position="-25 -25 60"></a-curve-point>
        <a-curve-point position="-50 -8 -60"></a-curve-point>
        <a-curve-point position="50 9 -60"></a-curve-point>
        <a-curve-point position="50 25 60"></a-curve-point>
        <a-curve-point position="0 17 60"></a-curve-point>
      </a-curve>
      <a-curve id="neutronStar"> 
        <a-curve-point position="0 17 60"></a-curve-point>
        <a-curve-point position="0 8 30"></a-curve-point>
        <a-curve-point position="-3.1 0 -1"></a-curve-point>
      </a-curve>
      <a-curve id="jetsMatter"> <!-- green -->
        <a-curve-point position="-3.1 0 -1"></a-curve-point>
        <a-curve-point position="-21 -20 36.3" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="revShock"> <!-- pink -->
        <a-curve-point position="-21 -20 36.3"></a-curve-point>
        <a-curve-point position="12 -11 32" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="FeK"> <!-- light blue -->
        <a-curve-point position="12 -11 32"></a-curve-point>
        <a-curve-point position="-18 24 44" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="arSpitzer"> <!-- yellow -->
        <a-curve-point position="-18 24 44"></a-curve-point>
        <a-curve-point position="-18 10 34" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="siChandra"> <!-- dark blue -->
        <a-curve-point position="-18 10 34"></a-curve-point>
        <a-curve-point position="-9.4 -15.2 45.9" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="outerKnots"> <!-- red -->
        <a-curve-point position="-9.4 -15.2 45.9"></a-curve-point>
        <a-curve-point position="-51 21 -1" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="endOfJet">
        <a-curve-point position="-51 21 -1"></a-curve-point>
        <a-curve-point position="60 25 -15" class="target"></a-curve-point>
      </a-curve>
      <a-curve id="track2">
        <a-curve-point position="60 25 -15"></a-curve-point>
        <a-curve-point position="0 0 0"></a-curve-point>
        <a-curve-point position="-1 -1 -3"></a-curve-point>
        <a-curve-point position="1 -20 -3"></a-curve-point>
      </a-curve>
      <a-curve id="track3">
        <a-curve-point position="1 -20 -3"></a-curve-point>
        <a-curve-point position="0 0 0"></a-curve-point>
        <a-curve-point position="-1 1 -3"></a-curve-point>
      </a-curve>
      
      <!-- Draw the Curve -->
<!--      <a-draw-curve curveref="#track1" material="color: blue;"></a-draw-curve>
      <a-draw-curve curveref="#track2" material="color: purple;"></a-draw-curve>
      <a-draw-curve curveref="#track3" material="color: green;"></a-draw-curve>
-->
      <a-entity id="textHolder"
                position="0 0 0"
                text="width: 1.5; color: white; align: center; 
                      anchor: center; side: double; 
                      value: *">
      </a-entity>
      
      <a-entity gltf-model="#cco" gltf-color="0.90 0.25 0.97">
      </a-entity>
      <a-entity gltf-model="#opt" gltf-color="0.94 0.32 0.4">
      </a-entity>
      <a-particles src="data/opt.csv"
                   id="testList"
                   color="#0F0"></a-particles>
      <a-particles src="data/cco.csv"
                   color="#F0F"></a-particles>
      <a-particles src="data/test1.csv"
                   color="#FFF"></a-particles>
      <a-particles src="data/x.csv"
                   color="#FF0"></a-particles>
      <a-particles src="data/y.csv"
                   color="#0FF"></a-particles>
      <a-particles src="data/z.csv"
                   color="#F0F"></a-particles>
      <a-entity camera alongpathevent 
                id="mainCamera"
                position="0 1.6 0"
                rotation="0 0 0"
                look-controls="pointerLockEnabled: true"
                alongpath="curve: #prepreOrbit; loop: false; dur: 1000;">
        <a-entity cursor="fuse: false;"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;"
                  material="color: #CCC; shader: flat;"></a-entity>
      </a-entity>
      <a-entity id="soundPlayer" sound="src: "></a-entity>
      <!-- <a-grid id="ground" 
                   material="src:../grid-cell.png; 
                   opacity:0.9"></a-grid> -->
  </a-scene>
  <div id="sound-streams">
    <audio id="Acceleration">
      <source src="data/Acceleration_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="Infrared">
      <source src="data/Infrared_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="Iron">
      <source src="data/Iron_Xray_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="Jets">
      <source src="data/Jets_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="NeutronStar">
      <source src="data/NeutronStar_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="OuterBlastOpt">
      <source src="data/OuterBlast_Opt_IR_AJ.WAV" type="audio/wav"></source>
    </audio>
    <audio id="OuterBlastXray">
      <source src="data/OuterBlast_Xray_AJ.WAV" type="audio/wav"></source>
    </audio>
  </div>
  <div id="splash">
    <div id="splash-inner">
      <div class="title">A Look at Cassiopeia A</div>
      <div class="sub-title">Little Star, Big Mess</div>
      <div id="go-button" onclick="pressStart()">Start</div>
      <!--<div id="go-button-silent" onclick="pressSilentStart()">(Silent)</div>-->
      <div class="sub-title">Created By</div>
      <br />
    </div>
  </div>
  <script type="text/javascript">
    // This stuff is down here at the end because it has to run as soon as
    // all the a-frame assets are loaded.  It manages the splash screen shown
    // above, by pausing the action as soon as everything is loaded, and then by
    // executing .play() when the start button is pressed.

    // Pause action as soon as everything is loaded.
    document.getElementById("mainScene").addEventListener("loaded",
      function() {
        document.getElementById('mainCamera').pause();
    });
    
    pressStart = function() {
      document.getElementById("splash").style.display = "none";
      document.getElementById("go-button").style.display = "none";
      /*document.getElementById("go-button-silent").style.display = "none";*/
      document.getElementById("mainCamera").play();

      // Load all the sounds and play-then-pause them all, to get them
      // permission to run under the iOS rules.
      var sounds = document.getElementsByTagName('audio');
      console.log("************", sounds, sounds[0]);
      for (i = 0; i < sounds.length; i++) {
        console.log("playing, then pausing:", sounds[i]);
        sounds[i].play(); sounds[i].pause();
      };
    }

    pressSilentStart = function() {
      document.getElementById("splash").style.display = "none";
      document.getElementById("go-button").style.display = "none";
      /* Not exactly sure how to signal that we want it silent. */
      /* document.getElementById("go-button-silent").style.display = "none"; */
      document.getElementById("mainCamera").play();
    }

    </script>
  </body>
</html>
